<!DOCTYPE html>
<html lang="en">
<!--
   __ ___   __  __               __
  / // (_) / /_/ /  ___ _______ / /
 / _  / / / __/ _ \/ -_) __/ -_)_/ 
/_//_/_/  \__/_//_/\__/_/  \__(_)  

  _      ____        __                                              __     ___ 
 | | /| / / /  ___ _/ /_  ___ ________   __ _____  __ __  __ _____  / /____/__ \
 | |/ |/ / _ \/ _ `/ __/ / _ `/ __/ -_) / // / _ \/ // / / // / _ \/ __/ _ \/__/
 |__/|__/_//_/\_,_/\__/  \_,_/_/  \__/  \_, /\___/\_,_/  \_,_/ .__/\__/\___(_)  
                                       /___/                /_/                 
-->
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Online Territory of Shikher Verma">

    <title>Do You Really Need An i7 - My Territory</title>

    <link rel="canonical" href="/blog/Do-You-Really-Need-An-i7">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/clean-blog.css">

    <link rel="stylesheet" href="/css/khaled.css">
    <link rel="stylesheet" href="/css/katex.min.css">

    <!-- Pygments Github CSS -->
    <link rel="stylesheet" href="/css/syntax.css">
    <!-- KTex for maths symbols-->
    <script src="/js/katex.min.js"></script>

    <!-- Custom Fonts -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href='//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

    <link type="application/atom+xml" rel="alternate" href="http://shikherverma.com/feed.xml" title="My Territory" />

</head>


<body>

    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">My Territory</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="/">Home</a>
                </li>
                             
                <li>
                    <a href="/">Blog</a>
                </li>
                        
                <li>
                    <a href="/index_">Khaled Ben Abdallah</a>
                </li>
                        
                <li>
                    <a href="/search/" class="nav-search-link" title="SEARCH">
                        <span class="fa fa-search nav-search-icon"></span>
                    </a>
                </li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>


    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<!-- Post Header -->
<header class="intro-header" style="background-image: url('/img/posts/chip-bg.jpg')">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <h1>Do You Really Need An i7</h1>
                    
                    <h2 class="subheading">Convincing people that your robot need more cpu power.</h2>
                    
                    <span class="meta" style='margin-top:0.5em;'>Posted by Shikher Verma on March 30, 2016
                    </span>
                    <span class="meta" style='margin-top:0.5em;'> Tags: <a href="/blog/tags/CodeMonkey"><i class="fa fa-tag"></i> CodeMonkey</a> <a href="/blog/tags/Robotics"><i class="fa fa-tag"></i> Robotics</a>  </span>
                    <span class="meta" style='margin-top:0.5em;'>
                        
                        <i class="fa fa-clock-o"></i>&nbsp;
                        6 minute read
                    </span>
                </div>
            </div>
        </div>
    </div>
</header>

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <h2 id="when-raspberry-pi-2-and-odroid-u3-fail-you">When Raspberry Pi 2 and Odroid U3 fail you</h2>

<h2 id="what-next--back-to-64-bit-">What next ? Back to 64 bit ?</h2>

<p>Initially Shikher thought that buying a low power armh processor was a very wise choice. Low power meant lower battery consumption so lighter batteries. Also single chip armh processors like Raspberry Pi and Odroid are way cheaper. The world was good. Until one day OpenCV came along. Initially he seemed like a nice guy. Resourceful. With his awesome HighGUI and slashy high power tools like HoughCircle, Contrast stretching he seemed like a guy Shikher could rely on. But soon Shikher became so dependant on him that he forgot the limited hardware that had to support OpenCV. The world started breaking apart. Shikher was caught up between using powerful tools of OpenCV or betraying our loyal companions odroid u3 and raspberry pi 2. Even then Shikher started looking for stronger boards which could meet the requirements of OpenCV. He soon came across NUC; One of the most powerful boards used in robotics projects. Shikher knew in his heart that he couldn’t just leave his old companions behind. After all they were the one because of which his project survived the last one year. But in the end, with a heavy heart Shikher had to pull the trigger on his old companions. Maybe it was not Raspberry and Odroid who fail Shikher; it was Shikher who failed them!</p>

<p>*wiping forhead* Phew!! This would have been so difficult if these board were alive.</p>

<h2 id="weighing-the-pros-and-cons">Weighing the pros and cons</h2>
<p>Pros:</p>

<ol>
  <li>Currently our image processing nodes take a lot of cpu usage. This is because a lot of OpenCV functions are lengthy matrix operations. One way is to reduce the frame rate so that once the last frame was processed we take the latest frame and process it; dropping all the frames in between. But this leads to very low fps and uneven rate of output. For better accuracy we need to run the image processing at the fps of camera rather than being limited by our processing speed. Other than this the filter on sensor data are also resource hungry and even though right now we don’t have complicated motion control and planning but later that too will require more processing power.</li>
  <li>Shifting to a 64 bit architecture makes software development easier because both rpi and odroid were armh architecture which had limited support in terms of precompiled binaries. We even encountered a bug which is armh specific.</li>
  <li>We are developing this auv not just for a competition but also to serve as a platform for doing underwater robotics research. In the future when we research and test more and more sophisticated algorithms we would want the testing platform to be free of any limitations.</li>
  <li>We are running Raspberry pi 2 (and earlier Odroid u3) in headless mode (without GUI) because we don’t have enough processing power to support GUI.</li>
  <li>With surplus resources we will have the freedom to experiment and add more features like running a webserver with the controls and output data exposed as a web page.</li>
  <li>In addition to this we also have the roscore, motion library and sensor nodes which have significant resource requirements. We expect the current requirements to increase because we will be running multiple task handlers, increasing the complexity in motion library and adding various debug nodes like a dashboard, system diagnostics and data logger.</li>
</ol>

<p>Cons:</p>

<ol>
  <li>Shifting to a more powerful processor would increase the battery requirement.</li>
  <li>But it can be managed by using batteries of higher capacity.</li>
</ol>

<h2 id="create-report">Create Report</h2>

<p>Hmm, how to log cpu usage. How to do this?
May be capture output of some monitor periodically against the pid of our process ?
What to use ? <code class="highlighter-rouge">top</code>/<code class="highlighter-rouge">htop</code>/<code class="highlighter-rouge">ps</code> ?
<code class="highlighter-rouge">ps</code>’s output seems easily processable.</p>

<ol>
  <li>
    <p>Start all the nodes and note their pid (process indentifier).</p>
  </li>
  <li>
    <p>So after starting all the ros nodes and roscore we need to log the output of ps periodically. Writing a script to log ps output. Luckily there was already such a thing writen. I found <a href="https://github.com/jeetsukumaran/Syrupy"><code class="highlighter-rouge">Syrupy</code></a> which does exactly this.</p>
  </li>
</ol>

<table>
  <thead>
    <tr>
      <th style="text-align: center">Time (s)</th>
      <th style="text-align: center">i5 CPU%</th>
      <th style="text-align: center">rpi CPU%</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center">1</td>
      <td style="text-align: center">29</td>
      <td style="text-align: center">70.2</td>
    </tr>
    <tr>
      <td style="text-align: center">2</td>
      <td style="text-align: center">26</td>
      <td style="text-align: center">75.9</td>
    </tr>
    <tr>
      <td style="text-align: center">3</td>
      <td style="text-align: center">25.6</td>
      <td style="text-align: center">95.4</td>
    </tr>
    <tr>
      <td style="text-align: center">4</td>
      <td style="text-align: center">25</td>
      <td style="text-align: center">93.7</td>
    </tr>
    <tr>
      <td style="text-align: center">5</td>
      <td style="text-align: center">25.4</td>
      <td style="text-align: center">94.2</td>
    </tr>
    <tr>
      <td style="text-align: center">6</td>
      <td style="text-align: center">24.6</td>
      <td style="text-align: center">95.6</td>
    </tr>
    <tr>
      <td style="text-align: center">7</td>
      <td style="text-align: center">21.2</td>
      <td style="text-align: center">95.4</td>
    </tr>
    <tr>
      <td style="text-align: center">8</td>
      <td style="text-align: center">21.3</td>
      <td style="text-align: center">95.3</td>
    </tr>
    <tr>
      <td style="text-align: center">9</td>
      <td style="text-align: center">21.1</td>
      <td style="text-align: center">95.4</td>
    </tr>
    <tr>
      <td style="text-align: center">10</td>
      <td style="text-align: center">21.2</td>
      <td style="text-align: center">95.4</td>
    </tr>
  </tbody>
</table>

<p><img src="/img/posts/graph-i5-rpi.png" alt="graph-i5-rpi" title="graph to show the difference better" /></p>

<h2 id="nuc-who">NUC who?</h2>
<p>Intel <em>N</em>ext <em>U</em>nit of <em>C</em>omputing is a 64 bit motherboard + Processor kit. Along with it you will have to buy Ram and SSD. For anyone looking to upgrade their robot’s cpu I suggest buying Intel NUC NUC5i7RYH.<br />
Buying it : <a href="http://www.amazon.in/intel-core-i7-NUC5i7RYH-kit/dp/B00WAS1FX6?tag=googinhydr18418-21">NUC</a><br />
Mandatory Accessories to Buy: <a href="http://www.amazon.in/Kingston-RAM-LAPTOP-1600MHZ-PC3L/dp/B00CQ35HBQ/ref=pd_bxgy_147_3?ie=UTF8&amp;refRID=0WM2SPDHFSSG4FR3BZ88">RAM</a> <a href="http://www.amazon.in/CRUCIAL-250-GB-SATA-CT250MX200SSD6/dp/B00RZ6GO98/ref=pd_bxgy_147_2?ie=UTF8&amp;refRID=0WM2SPDHFSSG4FR3BZ88">SSD</a><br />
Information links : <a href="http://www.intel.com/content/www/us/en/nuc/nuc-kit-nuc5i7ryh-brief.html">Product Brief</a> <a href="http://www.intel.com/content/www/us/en/nuc/nuc-kit-nuc5i7ryh.html">Product Overview</a><br />
Powering it : <a href="http://forums.trossenrobotics.com/showthread.php?6316-Intel-NUC&amp;s=366a85b68bb5d63dcf80397b0c52fe94&amp;p=59110#post59110">forum discussion</a> <a href="http://www.amazon.com/dp/B008FLE7PA/ref=pe_385040_30332190_pe_175190_21431760_M3T1_ST1_dp_1">Voltage Regulator</a><br />
Integrating RAM and MiniSSD: <a href="https://www.youtube.com/watch?v=SU4cdMm-8Qc">video</a></p>

<h2 id="planning-to-use-raspberry-and-odroid-too">Planning to use Raspberry and Odroid too.</h2>
<p>After all this, I also ordered a router. Now we are planning to run nuc, rpi and odroid all together so the whole ros software can be distributing across the whole linux cluster. This would also provide support for low power mode, when battery is low we can switch off nuc and use minimal control via rpi to bring auv back surface. Also fault tolerance is introduced. Even if one of the boards fail the rest can work in emergency.</p>

                <br>
                
                    <div id="disqus_thread"></div>
<script>
    var disqus_config = function () {
        this.page.url = shikherverma.com/blog/Do-You-Really-Need-An-i7;
        this.page.identifier = shikherverma.com/blog/Do-You-Really-Need-An-i7;
            };
    (function() {  // DON'T EDIT BELOW THIS LINE
        var d = document, s = d.createElement('script');
        
        s.src = '//shikherverma.disqus.com/embed.js';
        
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
                
                <br>
                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/blog/Yet-Another-Jekyll-Blog" data-toggle="tooltip" data-placement="top" title="Yet Another Jekyll Blog">&larr; Previous Post</a>
                    </li>
                    
                    
                    <li class="next">
                        <a href="/blog/Exams-Killed-The-Physicist" data-toggle="tooltip" data-placement="top" title="Exams Killed The Physicist">Next Post &rarr;</a>
                    </li>
                    
                </ul>

            </div>
        </div>
    </div>
</article>
<hr>


    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                    <li>
                        <a href="/feed.xml">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li>
                        <a href="https://www.facebook.com/shikherverma1">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-facebook fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li>
                        <a href="https://github.com/shikherverma">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li>
                        <a href="mailto:root@shikherverma.com">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-envelope fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                </ul>
                <p class="copyright text-muted"><a href="https://feedburner.google.com/fb/a/mailverify?uri=programmer-wannabe&amp;loc=en_US">Subscribe by Email</a> <br><br> Copyright &copy; Khaled Ben abdallah 2016</p>
            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<script src="/js/jquery.min.js "></script>

<!-- Bootstrap Core JavaScript -->
<script src="/js/bootstrap.min.js "></script>

<!-- Custom Theme JavaScript -->
<script src="/js/clean-blog.min.js "></script>


</body>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-75681059-1', 'auto');
  ga('send', 'pageview');

</script>
</html>
